import"./disclose-version.15-3dQtY.js";import{u as La,c as F,b as Na,r as J,p as Ra,d as v,g as t,e as k,a as Ja,s as la,A as n}from"./runtime.N9sK9yCX.js";import{e as ca}from"./each.-e9gUnfe.js";import{p,t as U,G as ua,i as pa,y as _a,N as Q,z as Qa,a as e,b as a,x as Va,F as fa,M as Wa,O as Xa,c as C,B as Za,C as D,D as g,s as x,o as E,j as ae,g as ba,e as ee,H as te,d as j}from"./render.FNm7pgUH.js";import{d as M,l as G,t as ma}from"./db.D4TSvIhG.js";import{t as ie}from"./lang.7t8SORkE.js";import{f as re,a as se}from"./fnSelect.wqP3uKO_.js";import{d as $}from"./dayjs.min.BNwor837.js";var oe=(h,d)=>v(d,!1),de=j('<div><iframe title="SS"></iframe></div>'),ne=j('<form><h1 text-lg="" mb-3=""> </h1> <div h-80vh="" overflow-auto=""><p pb-5=""> </p> <div grid="" grid-cols-1="" gap-5=""><div form-control="" max-w-full=""><span>Opsi Penilaian</span> <div><textarea input="" filter="" placeholder="Pilih Opsi" min-h-8="" rounded-box=""></textarea> <input type="hidden" selected> <div relative="" w-full=""><ul menu="" top-0="" hidden absolute="" bg-base="" h-48="" z-10="" overflow-auto="" rounded-box="" shadow=""><li option=""><label flex="" gap-2="" cursor-pointer=""><input type="checkbox" checkbox="" shrink-0="" tabindex="-1"> <div option-label=""></div></label></li></ul></div></div></div> <div form-control="" max-w-full=""><span>Keterangan</span> <textarea input="" rows="3" h-auto="" rounded-box=""></textarea></div> <div form-control="" max-w-full=""><input type="file" input="" multiple> <div><div carousel="" w-full="" rounded-box="" min-h-40vh="" border=""></div></div></div></div></div> <div><button btn="~ primary"><i></i> </button></div></form>'),ve=(h,d,l)=>v(d,p(l(t(d)).add(-1,"day").format("YYYY-MM-DD"))),le=(h,d,l)=>v(d,p(l(t(d)).add(1,"day").format("YYYY-MM-DD"))),ce=j('<div absolute="" top-0="" z-20="" w-full="" h-2="" bg-neutral="" animate-pulse="" animate-count-infinite=""></div>'),ue=j('<div card="" relative=""><div absolute="" top-0="" right-0=""><span badge=""> </span></div> <img alt="Album" rounded-xl="" min-h-48=""> <div important-px-2=""><a text-lg="" uppercase="" target="_blank"> </a> <div><span badge="" badge-primary=""> </span></div></div></div>'),pe=j('<div modal=""><div w-5xl="" max-w-full=""><button modal-close="">&times;</button> <!></div></div> <div><div sticky="" top-0="" z-10="" bg-base-a="" pt-10="" pb-3="" mx--5="" px-5=""><div flex="" gap-5=""><h1 text-xl="">Sites Monitoring</h1> <button btn="~ sm circle outline" aria-label="Refresh" p-.5=""><i i-bx-refresh="" animate-reverse=""></i></button></div> <div><div flex=""><a href="../" btn="~ xs"> </a></div></div> <div flex="" pt-5="" gap-5="" justify-between=""><div whitespace-nowrap=""><span btn="~ sm primary"> </span> <span btn="~ sm success"> </span> <span btn="~ sm error"> </span></div> <div group-x-rounded=""><input input="" type="date" w-48=""> <button btn=""><i i-bx-chevron-left=""></i></button> <button btn=""><i i-bx-chevron-right=""></i></button></div></div></div> <div bg-base-a="" min-h-70vh="" sticky="" top-20=""><!> <div relative="" z-20="" pt-5=""><div grid="" grid-cols-1="" md:grid-cols-3="" gap-5=""></div></div></div></div>',!0);function _e(h,d){Ja(d,!0);const l={};La(l);const y=()=>la(G,"$loading",l),H=()=>la(ie,"$t",l);function ga(r,s){return r.reduce((c,u,f,b,m=s(u))=>((c[m]||(c[m]=[])).push(u),c),{})}let S=F(void 0),z=F(p({error:0,success:0,total:0})),_=F(p($().format("YYYY-MM-DD"))),i=F(void 0);Na(()=>{K()});async function K(){k(G,!0),v(S,p(await M.collection("sitesAudit").getList(1,500,{filter:[`created>="${t(_)}"`,`created<"${$(t(_)).add(1,"day").format("YYYY-MM-DD")}"`].join("&&"),expand:"siteId,screenshot",sort:"@random"})));let r=ga(t(S)?.items||[],s=>s.status);v(z,p({success:r.success?.length||0,error:r.error?.length||0,total:t(S)?.items?.length||0})),setTimeout(()=>k(G,!1),500)}async function xa(){k(G,!0);try{const r={template:t(i).template,question:t(i).id,answer:t(i).answer,score:t(i).score,media:t(i).file?[...t(i).file]:void 0};console.log(r,t(i)),t(i).aid?await M.collection("auditsDetails").update(t(i).aid,r):await M.collection("auditsDetails").create(r),k(ma,[{action:H()("action.saved")}])}catch(r){console.log(r),k(ma,[{error:r?.data}])}v(i,!1),K()}var V=te(h,!0,pe),O=Za(V),ha=e(O),W=e(ha),ya=a(a(W)),wa=a(a(O)),X=e(wa),Z=e(X),Ya=e(Z),aa=a(a(Ya)),ka=e(aa),ea=a(a(Z)),Da=e(ea),Ma=e(Da),$a=e(Ma),ja=a(a(ea)),ta=e(ja),ia=e(ta),Sa=e(ia),ra=a(a(ia)),za=e(ra),Oa=a(a(ra)),Aa=e(Oa),Ia=a(a(ta)),L=e(Ia);fa(L);var sa=a(a(L)),Pa=a(a(sa)),Ta=a(a(X)),oa=e(Ta),qa=a(a(oa)),Ba=e(qa);U($a,()=>H()("all.info")),J(()=>{D(ka,"animate-spin",y()),g(Sa,`Total : ${x(t(z).total)}`),g(za,`Success : ${x(t(z).success)}`),g(Aa,`Error : ${x(t(z).error)}`)}),ua(O,(r,s)=>re(r,s),()=>t(i)),pa("close",O,()=>v(i,!1),!1),W.__click=[oe,i],_a(ya,()=>t(i),r=>{var s=E(r,!0,ne),c=e(s),u=e(c),f=a(a(c)),b=e(f),m=e(b),A=a(a(b)),I=e(A),w=e(I),P=a(a(w)),N=e(P),T=a(a(N));fa(T);var q=a(a(I)),Y=e(q),da=a(a(Y));Wa(da);var Fa=a(a(q)),na=e(Fa),Ua=a(a(na)),Ca=e(Ua),Ea=a(a(f)),Ga=e(Ea),B=e(Ga),Ha=a(B);U(Ha,()=>` ${x(H()("save.btn"))}`),J(()=>{g(u,`${x(t(i).question)} (${x(t(i).score)})`),g(m,t(i).hint),D(B,"i-bx-save",!y()),D(B,"i-bx-refresh",y()),D(B,"animate-spin",y())}),pa("submit",s,ae(xa),!1),ua(P,(o,R)=>se(o,R),()=>t(i).options),Q(T,()=>t(i).score,o=>t(i).score=o),Q(da,()=>t(i).answer,o=>t(i).answer=o),Xa("files","change","set",na,()=>t(i).file,o=>t(i).file=o),ca(Ca,()=>t(i).media,73,(o,R,fe)=>{var va=E(o,!0,de),Ka=e(va);ba(Ka,"src",()=>M.files.getUrl(t(i),n(R))),C(o,va)},null),C(r,s)},null),aa.__click=K,Q(L,()=>t(_),r=>v(_,p(r))),sa.__click=[ve,_,$],Pa.__click=[le,_,$],_a(oa,y,r=>{var s=E(r,!0,ce);C(r,s)},null),ca(Ba,()=>t(S)?.items,73,(r,s,c)=>{var u=E(r,!0,ue),f=e(u),b=e(f),m=e(b),A=a(a(f)),I=a(a(A)),w=e(I),P=e(w),N=a(a(w)),T=e(N),q=e(T);ba(A,"src",()=>M.getFileUrl(n(s)?.expand?.screenshot,n(s)?.expand?.screenshot?.media)),U(P,()=>n(s)?.expand?.siteId?.name?.replace(".mojokertokota.go.id","")),U(q,()=>$(n(s).created).format("YYYY-MM-DD hh:mm:ss"));var Y;J(()=>{D(b,"badge-success",n(s).status=="success"),g(m,n(s).status),Y!==(Y="http://"+n(s)?.expand?.siteId?.name)&&ee(w,"href",Y)}),C(r,u)},null),Qa(h,V),Ra()}Va(["click"]);const ke=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"}));export{_e as _,ke as a};
