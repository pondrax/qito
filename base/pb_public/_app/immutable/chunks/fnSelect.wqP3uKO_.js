const U=(n,r)=>{const a=(i=!1)=>{i?n.classList.add("modal-open"):n.classList.remove("modal-open")},o=i=>{i.target instanceof HTMLElement&&n===i.target&&n.dispatchEvent(new CustomEvent("close"))},u=i=>{i.key==="Escape"&&n.dispatchEvent(new CustomEvent("close"))};return a(r),n.addEventListener("mousedown",o,!0),window.addEventListener("keydown",u,!0),{update(i){a(i)},destroy(){n.removeEventListener("mousedown",o,!0),window.removeEventListener("keydown",u,!0)}}},P=(n,r)=>{r=r.replace(/\[(\w+)\]/g,".$1"),r=r.replace(/^\./,"");const a=r.split(".");let o=n;for(;a.length;){const u=a.shift()||"";if(o){if(!(u in o))return;o=o[u]}}return o};function V(n,r){let a;const o=n.getAttribute("keyvalue")||"id",u=n.getAttribute("keylabel")||"name",i=n.hasAttribute("multiple");let h=[],l=[],y=!1,p=-1,x=!1;const c=n.querySelector("[filter]"),g=n.querySelector("[selected]"),d=n.querySelector("[menu]"),S=d.querySelector("[option]"),L=document.createElement("div");n.classList.add("relative","!flex-col","w-full"),d.classList.add("hidden","z-10","absolute","top-0","w-full"),L.className="flex flex-wrap !justify-start gap-1",n.appendChild(L);const E=S.cloneNode(!0),k=E.querySelector('[type="checkbox"]'),b=E.querySelector("[option-label]");b.innerText=i?"-- Tambahkan Semua --":"-- Hapus Pilihan --",b.classList.add("text-stone"),k.addEventListener("change",C),c.addEventListener("focus",q),c.addEventListener("blur",A),c.addEventListener("keydown",M),c.addEventListener("input",T),document.addEventListener("mousedown",H),document.addEventListener("mouseup",B),R();function C(){i?k.checked?(l=a,b.innerText="[Clear Selection]"):(l=[],b.innerText="[Add All]"):l=[],w(),g.dispatchEvent(new Event("input"))}function T(){const e=String(c.value).toLowerCase();h.forEach((t,s)=>{(String(a[s][u])?.toLowerCase()).includes(e)?t.style.display="block":t.style.display="none"}),i||(L.textContent="")}function q(){d.style.display="block",y=!0}function A(){x||(d.style.display="none",y=!1),x=!1}function M(e){e.key==="ArrowDown"||e.key==="ArrowUp"?(e.preventDefault(),D(e.key==="ArrowDown"?"next":"prev")):e.key==="Enter"&&(e.preventDefault(),j())}function H(e){const t=e.target;x=!0,y&&!d.contains(t)&&(d.style.display="none",y=!1)}function B(e){const t=e.target;y&&d.contains(t)&&(i||(d.style.display="none",y=!1))}function D(e){const t=[E,...h.filter(s=>s.style.display!=="none")];t.length!==0&&(e==="next"?p=(p+1)%t.length:p=(p-1+t.length)%t.length,p>=0&&t.forEach((s,f)=>{if(f===p){s.children[0]?.classList?.add("bg-neutral:10");const v=s.parentElement,m=s.getBoundingClientRect(),I=v.getBoundingClientRect(),K=m.top-I.top;v.scrollTop+=K-8}else s.children[0]?.classList?.remove("bg-neutral:10")}))}function j(){if(p>=0&&p<h.length+1){const e=[E,...h][p].querySelector('[type="checkbox"]');e.checked=!e.checked,e.dispatchEvent(new Event("change")),c.blur()}}function w(e=!1){e&&c.focus(),h.forEach(t=>{const s=t.querySelector('[type="checkbox"]');s.checked=l.some(f=>f[o].toString()===s.value)}),i?(g.value=l.map(t=>t[o]).join(","),L.innerHTML=l.map(t=>`<span badge="~ primary" hover-badge-secondary>${t[u]}</span>`).join(" "),n.dispatchEvent(new CustomEvent("selected",{detail:l}))):(g.value=l.at(0)?.[o]||"",c.value=l.at(0)?.[u]||"",c.style.height=c.scrollHeight+2+"px",k.checked=!1,n.dispatchEvent(new CustomEvent("selected",{detail:l.at(0)})))}function R(){if(r&&(typeof r.at(0)=="string"?a=r.map(e=>({id:e,name:e})):a=r,d.textContent="",d.appendChild(E),h=[],a.forEach(e=>{const t=S.cloneNode(!0),s=t.querySelector('[type="checkbox"]'),f=t.querySelector("[option-label]");s.value=String(e[o]),f.textContent?f.innerHTML=f.innerHTML.replace(/\((.*?)\)/g,(v,m)=>String(P(e,m))||v)||"":f.textContent=e[u],s.addEventListener("change",()=>{i?s.checked?l.push(e):l=l.filter(v=>v[o]!==e[o]):(l=s.checked?[e]:[],h.forEach(v=>{const m=v.querySelector('[type="checkbox"]');m.checked=m.value===e[o].toString()})),w(),g.dispatchEvent(new Event("input"))}),h.push(t),d.appendChild(t)}),c.value!=""&&(l=a.filter(e=>String(e[u]).toLowerCase()==String(c.value).toLowerCase()),w()),g.value!="")){const e=g.value.split(",");l=a.filter(t=>e.reduce((s,f)=>String(t[o]).toLowerCase()==String(f).toLowerCase()||s,!1)),l.length>0&&setTimeout(()=>{n.dispatchEvent(new CustomEvent("selected",{detail:l.at(0)}))},1),w()}}function F(e){r!==e&&(r=e,R(),w())}function N(){k.removeEventListener("change",C),c.removeEventListener("focus",q),c.removeEventListener("blur",A),c.removeEventListener("keydown",M),c.removeEventListener("input",T),document.removeEventListener("mousedown",H)}return{update:F,destroy:N}}export{V as a,U as f};
