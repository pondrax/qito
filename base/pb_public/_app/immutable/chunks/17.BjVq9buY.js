import{u as Ra,t as J,r as ea,O as fa,v as N,Z as ta,H as Za,b as a,a3 as Ca,_ as Ga,c as R,J as Qa,a as e,N as ma,K as $,L as w,s as y,o as Z,a0 as Va,w as Wa,q as ba,e as Xa,P as ae,f as S,d as P}from"./disclose-version.DshyVd_Z.js";import{s as C,p as ee,b as m,g as t,a as te,x as f}from"./runtime.Cuj63gjm.js";import{e as xa}from"./each.Oi8QW3YR.js";import{i as ga}from"./if.BXalDDPe.js";import{u as re,s as ha,a as j}from"./store.DRzovyat.js";import{p as Y}from"./proxy.D3N1WS_I.js";import{d as z,l as G,t as wa}from"./db.FEB5Gfq4.js";import{t as ie}from"./lang.DpQJuId4.js";import{f as se,a as oe}from"./fnSelect.CKqNMbYj.js";import{d as O}from"./dayjs.min.CxMP4GVf.js";var de=P('<div><iframe title="SS"></iframe></div>'),ne=P('<form><h1 text-lg="" mb-3=""> </h1> <div h-80vh="" overflow-auto=""><p pb-5=""> </p> <div grid="" grid-cols-1="" gap-5=""><div form-control="" max-w-full=""><span>Opsi Penilaian</span> <div><textarea input="" filter="" placeholder="Pilih Opsi" min-h-8="" rounded-box=""></textarea> <input type="hidden" selected> <div relative="" w-full=""><ul menu="" top-0="" hidden absolute="" bg-base="" h-48="" z-10="" overflow-auto="" rounded-box="" shadow=""><li option=""><label flex="" gap-2="" cursor-pointer=""><input type="checkbox" checkbox="" shrink-0="" tabindex="-1"> <div option-label=""></div></label></li></ul></div></div></div> <div form-control="" max-w-full=""><span>Keterangan</span> <textarea input="" rows="3" h-auto="" rounded-box=""></textarea></div> <div form-control="" max-w-full=""><input type="file" input="" multiple> <div><div carousel="" w-full="" rounded-box="" min-h-40vh="" border=""></div></div></div></div></div> <div><button btn="~ primary"><i></i> </button></div></form>'),ve=(q,b,x)=>m(b,Y(x(t(b)).add(-1,"day").format("YYYY-MM-DD"))),le=(q,b,x)=>m(b,Y(x(t(b)).add(1,"day").format("YYYY-MM-DD"))),ue=P('<div absolute="" top-0="" z-20="" w-full="" h-2="" bg-neutral="" animate-pulse="" animate-count-infinite=""></div>'),pe=P('<div card="" relative=""><div absolute="" top-0="" right-0=""><span badge=""> </span></div> <img alt="Album" rounded-xl="" min-h-48=""> <div important-px-2=""><a text-lg="" uppercase="" target="_blank"> </a> <div><span badge="" badge-primary=""> </span></div></div></div>'),ce=P('<div modal=""><div w-5xl="" max-w-full=""><button modal-close="">&times;</button> <!></div></div> <div><div sticky="" top-0="" z-10="" bg-base-a="" pt-10="" pb-3="" mx--5="" px-5=""><div flex="" gap-5=""><h1 text-xl="">Sites Monitoring</h1> <button btn="~ sm circle outline" aria-label="Refresh" p-.5=""><i i-bx-refresh="" animate-reverse=""></i></button></div> <div><div flex=""><a href="../" btn="~ xs"> </a></div></div> <div flex="" pt-5="" gap-5="" md:justify-between="" flex-wrap=""><div whitespace-nowrap=""><span btn="~ sm primary"> </span> <span btn="~ sm success"> </span> <span btn="~ sm error"> </span></div> <div group-x-rounded=""><input input="" type="date" w-48=""> <button btn=""><i i-bx-chevron-left=""></i></button> <button btn=""><i i-bx-chevron-right=""></i></button></div></div></div> <div bg-base-a="" min-h-70vh="" sticky="" top-20=""><!> <div relative="" z-20="" pt-5=""><div grid="" grid-cols-1="" md:grid-cols-3="" gap-5=""></div></div></div></div>',!0);function _e(q,b){te(b,!0);const x={};re(x);const k=()=>ha(G,"$loading",x),Q=()=>ha(ie,"$t",x);function ya(r,s){return r.reduce((n,v,p,c,_=s(v))=>((n[_]||(n[_]=[])).push(v),n),{})}let I=C(void 0),T=C(Y({error:0,success:0,total:0})),h=C(Y(O().format("YYYY-MM-DD"))),i=C(void 0);Ra(()=>{V()});async function V(){var s,n,v,p,c;j(G,!0),m(I,Y(await z.collection("sitesAudit").getList(1,500,{filter:[`created>="${t(h)}"`,`created<"${O(t(h)).add(1,"day").format("YYYY-MM-DD")}"`].join("&&"),expand:"siteId,screenshot",sort:"@random"})));let r=ya(((s=t(I))==null?void 0:s.items)||[],_=>_.status);m(T,Y({success:((n=r.success)==null?void 0:n.length)||0,error:((v=r.error)==null?void 0:v.length)||0,total:((c=(p=t(I))==null?void 0:p.items)==null?void 0:c.length)||0})),setTimeout(()=>j(G,!1),500)}async function Ya(){j(G,!0);try{const r={template:t(i).template,question:t(i).id,answer:t(i).answer,score:t(i).score,media:t(i).file?[...t(i).file]:void 0};console.log(r,t(i)),t(i).aid?await z.collection("auditsDetails").update(t(i).aid,r):await z.collection("auditsDetails").create(r),j(wa,[{action:Q()("action.saved")}])}catch(r){console.log(r),j(wa,[{error:r==null?void 0:r.data}])}m(i,!1),V()}var ra=ae(q,!0,ce),A=Qa(ra),ka=e(A),ia=e(ka),Da=a(a(ia,!0)),Ma=a(a(A,!0)),sa=e(Ma),oa=e(sa),$a=e(oa),da=a(a($a,!0)),Sa=e(da),na=a(a(oa,!0)),ja=e(na),za=e(ja),Oa=S(e(za)),Pa=a(a(na,!0)),va=e(Pa),la=e(va),qa=e(la),ua=a(a(la,!0)),Ia=e(ua),Ta=a(a(ua,!0)),Aa=e(Ta),Ka=a(a(va,!0)),W=e(Ka);ma(W);var pa=a(a(W,!0)),La=a(a(pa,!0)),Ua=a(a(sa,!0)),ca=e(Ua),Ba=a(a(ca,!0)),Ea=e(Ba);J(Oa,()=>Q()("all.info")),ea(()=>{$(Sa,"animate-spin",k()),w(qa,`Total : ${y(t(T).total)}`),w(Ia,`Success : ${y(t(T).success)}`),w(Aa,`Error : ${y(t(T).error)}`)}),fa(A,(r,s)=>se(r,s),()=>t(i)),N("close",A,()=>m(i,!1),!1),N("click",ia,()=>m(i,!1),!1),ga(Da,()=>t(i),r=>{var s=Z(r,!0,ne),n=e(s),v=e(n),p=a(a(n,!0)),c=e(p),_=S(e(c)),K=a(a(c,!0)),L=e(K),D=e(L),U=a(a(D,!0)),X=e(U),B=a(a(X,!0));ma(B);var E=a(a(L,!0)),M=e(E),o=a(a(M,!0));Va(o);var l=a(a(E,!0)),d=e(l),g=a(a(d,!0)),F=e(g),Fa=a(a(p,!0)),Ha=e(Fa),H=e(Ha),Ja=a(H,!0);J(Ja,()=>` ${y(Q()("save.btn"))}`),ea(()=>{w(v,`${y(t(i).question)} (${y(t(i).score)})`),w(_,t(i).hint),$(H,"i-bx-save",!k()),$(H,"i-bx-refresh",k()),$(H,"animate-spin",k())}),N("submit",s,Wa(Ya),!1),fa(U,(u,aa)=>oe(u,aa),()=>t(i).options),ta(B,()=>t(i).score,u=>t(i).score=u),ta(o,()=>t(i).answer,u=>t(i).answer=u),Ga("files","change","set",d,()=>t(i).file,u=>t(i).file=u),xa(F,()=>t(i).media,73,(u,aa,fe)=>{var _a=Z(u,!0,de),Na=e(_a);ba(Na,"src",()=>z.files.getUrl(t(i),f(aa))),R(u,_a)},null),R(r,s)},null),N("click",da,V,!1),ta(W,()=>t(h),r=>m(h,r)),pa.__click=[ve,h,O],La.__click=[le,h,O],ga(ca,k,r=>{var s=Z(r,!0,ue);R(r,s)},null),xa(Ea,()=>{var r;return(r=t(I))==null?void 0:r.items},73,(r,s,n)=>{var v=Z(r,!0,pe),p=e(v),c=e(p),_=S(e(c)),K=a(a(p,!0)),L=a(a(K,!0)),D=e(L),U=S(e(D)),X=a(a(D,!0)),B=e(X),E=S(e(B));ba(K,"src",()=>{var o,l,d,g,F;return z.getFileUrl((l=(o=f(s))==null?void 0:o.expand)==null?void 0:l.screenshot,(F=(g=(d=f(s))==null?void 0:d.expand)==null?void 0:g.screenshot)==null?void 0:F.media)}),J(U,()=>{var o,l,d,g;return(g=(d=(l=(o=f(s))==null?void 0:o.expand)==null?void 0:l.siteId)==null?void 0:d.name)==null?void 0:g.replace(".mojokertokota.go.id","")}),J(E,()=>O(f(s).created).format("YYYY-MM-DD hh:mm:ss"));var M;ea(()=>{var o,l,d;$(c,"badge-success",f(s).status=="success"),w(_,f(s).status),M!==(M="http://"+((d=(l=(o=f(s))==null?void 0:o.expand)==null?void 0:l.siteId)==null?void 0:d.name))&&Xa(D,"href",M)}),R(r,v)},null),Za(q,ra),ee()}Ca(["click"]);const Me=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"}));export{_e as _,Me as a};
