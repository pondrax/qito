import{i as Ct,t as $,r as W,O as ft,v as q,H as Ht,Z as pt,_ as Jt,c as m,J as Nt,a as t,b as a,N as X,K as P,o as h,a0 as Ut,s as Y,L as tt,w as Zt,q as Bt,a1 as Et,e as Ft,a2 as Gt,P as It,f as x,d as _}from"./disclose-version.DshyVd_Z.js";import{p as Qt,a as Vt,b as c,a1 as at,g as e,m as et,x as s}from"./runtime.Cuj63gjm.js";import{e as H}from"./each.Oi8QW3YR.js";import{i as bt}from"./if.BXalDDPe.js";import{u as Wt,a as D,s as mt}from"./store.DRzovyat.js";import{d as J,l as N,t as ht}from"./db.FEB5Gfq4.js";import{o as Xt}from"./main-client.DP_Dx0-m.js";import{t as Yt}from"./lang.DpQJuId4.js";import{f as ta,a as aa}from"./fnSelect.CKqNMbYj.js";var ea=_('<div><iframe title="SS"></iframe></div>'),ia=_('<form><h1 text-lg="" mb-3=""> </h1> <div h-80vh="" overflow-auto=""><p pb-5=""> </p> <div grid="" grid-cols-1="" gap-5=""><div form-control="" max-w-full=""><span>Opsi Penilaian</span> <div><textarea input="" filter="" placeholder="Pilih Opsi" min-h-8="" rounded-box=""></textarea> <input type="hidden" selected> <div relative="" w-full=""><ul menu="" top-0="" hidden absolute="" bg-base="" h-48="" z-10="" overflow-auto="" rounded-box="" shadow=""><li option=""><label flex="" gap-2="" cursor-pointer=""><input type="checkbox" checkbox="" shrink-0="" tabindex="-1"> <div option-label=""></div></label></li></ul></div></div></div> <div form-control="" max-w-full=""><span>Keterangan</span> <textarea input="" rows="3" h-auto="" rounded-box=""></textarea></div> <div form-control="" max-w-full=""><input type="file" input="" multiple> <div><div carousel="" w-full="" rounded-box="" min-h-40vh="" border=""></div></div></div></div></div> <div><button btn="~ primary"><i></i> </button></div></form>'),ra=_('<div absolute="" top-0="" z-20="" w-full="" h-2="" bg-neutral="" animate-pulse="" animate-count-infinite=""></div>'),da=_('<div underline=""> </div>'),la=_('<div underline=""> </div>'),oa=_('<tr><td sticky="" left-0=""><input type="checkbox" checkbox=""></td><td><a btn="~ sm"><i i-bx-detail=""></i></a></td><td><div><!></div></td><td> </td><td></td><td></td></tr>'),sa=_('<div modal=""><div w-5xl="" max-w-full=""><button modal-close="">&times;</button> <!></div></div> <div><div sticky="" top-0="" z-10="" bg-base-a="" pt-15="" pb-3=""><div flex="" gap-5=""><h1 text-xl=""> </h1> <button btn="~ sm circle outline" aria-label="Refresh" p-.5=""><i i-bx-refresh="" animate-reverse=""></i></button></div> <div><div flex=""><button btn="~ xs"> </button></div></div></div> <div bg-base="" min-h-70vh="" relative=""><!> <div><table table="" w-full=""><thead><tr children-bg-base-b="" sticky="" top-0=""><th sticky="" left-0="" w-1="" aria-label="Checkbox" h-15=""><input type="checkbox" checkbox=""></th><th></th><th>Ruang Lingkup</th><th>Organisasi</th><th>Auditee</th><th>Auditor</th></tr></thead><tbody></tbody></table></div></div></div>',!0);function na(it,xt){Vt(xt,!1);const U={};Wt(U);const f=()=>mt(N,"$loading",U),K=()=>mt(Yt,"$t",U),gt=[];let g=et(),p=et([]),i=et();Xt(async()=>{await Z()});async function Z(){D(N,!0),c(g,await J.collection("audits").getList(1,500,{filter:'template.id="indeks_kami_4_2"',expand:"organization,auditee,auditor",sort:"-created",requestKey:"ikami"})),setTimeout(()=>D(N,!1),500)}async function kt(){D(N,!0);try{const r={template:e(i).template,question:e(i).id,answer:e(i).answer,score:e(i).score,media:e(i).file?[...e(i).file]:void 0};console.log(r,e(i)),e(i).aid?await J.collection("auditsDetails").update(e(i).aid,r):await J.collection("auditsDetails").create(r),D(ht,[{action:K()("action.saved")}])}catch(r){console.log(r),D(ht,[{error:r==null?void 0:r.data}])}c(i,!1),Z()}Ct();var rt=It(it,!0,sa),L=Nt(rt),wt=t(L),dt=t(wt),yt=a(a(dt,!0)),zt=a(a(L,!0)),lt=t(zt),ot=t(lt),st=t(ot),Ot=x(t(st)),nt=a(a(st,!0)),St=t(nt),$t=a(a(ot,!0)),qt=t($t),Pt=t(qt),Dt=x(t(Pt)),Kt=a(a(lt,!0)),vt=t(Kt),Lt=a(a(vt,!0)),ut=t(Lt),ct=t(ut),Mt=t(ct),jt=t(Mt),B=t(jt);X(B);var At=a(ct);$(Ot,()=>K()("audit.indekskami.title")),$(Dt,()=>K()("all.info"));var E;W(()=>{var r;P(St,"animate-spin",f()),P(ut,"opacity-50",f()),E!==(E=e(p).length==((r=e(g))==null?void 0:r.items.length))&&(B.checked=E)}),ft(L,(r,d)=>ta(r,d),()=>e(i)),q("close",L,()=>c(i,!1),!1),q("click",dt,()=>c(i,!1),!1),bt(yt,()=>e(i),r=>{var d=h(r,!0,ia),F=t(d),M=t(F),k=a(a(F,!0)),v=t(k),j=x(t(v)),G=a(a(v,!0)),w=t(G),I=t(w),A=a(a(I,!0)),R=t(A),T=a(a(R,!0));X(T);var y=a(a(w,!0)),Q=t(y),z=a(a(Q,!0));Ut(z);var O=a(a(y,!0)),l=t(O),o=a(a(l,!0)),b=t(o),u=a(a(k,!0)),S=t(u),C=t(S),Rt=a(C,!0);$(Rt,()=>` ${Y(K()("save.btn"))}`),W(()=>{tt(M,`${Y(e(i).question)} (${Y(e(i).score)})`),tt(j,e(i).hint),P(C,"i-bx-save",!f()),P(C,"i-bx-refresh",f()),P(C,"animate-spin",f())}),q("submit",d,Zt(kt),!1),ft(A,(n,V)=>aa(n,V),()=>e(i).options),pt(T,()=>e(i).score,n=>at(i,e(i).score=n)),pt(z,()=>e(i).answer,n=>at(i,e(i).answer=n)),Jt("files","change","set",l,()=>e(i).file,n=>at(i,e(i).file=n)),H(b,()=>e(i).media,9,(n,V,va)=>{var _t=h(n,!0,ea),Tt=t(_t);Bt(Tt,"src",()=>J.files.getUrl(e(i),s(V))),m(n,_t)},null),m(r,d)},null),q("click",nt,Z,!1),bt(vt,f,r=>{var d=h(r,!0,ra);m(r,d)},null),q("click",B,()=>{var r,d;return e(p).length==((r=e(g))==null?void 0:r.items.length)?c(p,[]):c(p,(d=e(g))==null?void 0:d.items)},!1),H(At,()=>{var r;return((r=e(g))==null?void 0:r.items)||[]},9,(r,d,F)=>{var M=h(r,!0,oa),k=t(M),v=t(k);X(v);var j=a(k),G=t(j),w=a(j),I=t(w),A=t(I);Et(A,()=>s(d).scope,!1);var R=a(w),T=x(t(R)),y=a(R),Q=a(y),z,O;W(()=>{var l,o,b;z!==(z=s(d))&&(v.value=(v.__value=s(d))==null?"":s(d)),O!==(O="./detail?"+s(d).id)&&Ft(G,"href",O),tt(T,(b=(o=(l=s(d))==null?void 0:l.expand)==null?void 0:o.organization)==null?void 0:b.name)}),Gt(gt,[],v,()=>(s(d),e(p)),l=>c(p,l)),H(y,()=>{var l,o;return((o=(l=s(d))==null?void 0:l.expand)==null?void 0:o.auditee)||[]},9,(l,o,b)=>{var u=h(l,!0,da),S=x(t(u));$(S,()=>s(o).name),m(l,u)},null),H(Q,()=>{var l,o;return((o=(l=s(d))==null?void 0:l.expand)==null?void 0:o.auditor)||[]},9,(l,o,b)=>{var u=h(l,!0,la),S=x(t(u));$(S,()=>s(o).name),m(l,u)},null),m(r,M)},null),Ht(it,rt),Qt()}const ga=Object.freeze(Object.defineProperty({__proto__:null,default:na},Symbol.toStringTag,{value:"Module"}));export{na as _,ga as a};
