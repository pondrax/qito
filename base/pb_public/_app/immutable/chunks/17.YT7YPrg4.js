import"./disclose-version.15-3dQtY.js";import{u as La,t as E,w as Na,r as H,p as Ra,z as v,y as t,b as k,a as Ha,s as la,A as n}from"./runtime.bbI-llpg.js";import{e as ua}from"./each.EYzjG2Rp.js";import{J as p,t as F,F as ca,g as pa,w as _a,N as Q,x as Qa,a as e,b as a,v as Va,E as fa,M as Wa,O as Xa,c as U,z as Za,A as M,C as x,s as g,o as C,p as ae,f as ba,B as ee,G as te,d as z}from"./render.xdaRgOar.js";import{d as D,l as G,t as ma}from"./db.DaXTXu79.js";import{t as ie}from"./lang.ucBuaWId.js";import{f as re,a as se}from"./fnSelect.wqP3uKO_.js";import{d as $}from"./dayjs.min.BNwor837.js";var oe=(h,d)=>v(d,!1),de=z('<div><iframe title="SS"></iframe></div>'),ne=z('<form><h1 text-lg="" mb-3=""> </h1> <div h-80vh="" overflow-auto=""><p pb-5=""> </p> <div grid="" grid-cols-1="" gap-5=""><div form-control="" max-w-full=""><span>Opsi Penilaian</span> <div><textarea input="" filter="" placeholder="Pilih Opsi" min-h-8="" rounded-box=""></textarea> <input type="hidden" selected> <div relative="" w-full=""><ul menu="" top-0="" hidden absolute="" bg-base="" h-48="" z-10="" overflow-auto="" rounded-box="" shadow=""><li option=""><label flex="" gap-2="" cursor-pointer=""><input type="checkbox" checkbox="" shrink-0="" tabindex="-1"> <div option-label=""></div></label></li></ul></div></div></div> <div form-control="" max-w-full=""><span>Keterangan</span> <textarea input="" rows="3" h-auto="" rounded-box=""></textarea></div> <div form-control="" max-w-full=""><input type="file" input="" multiple> <div><div carousel="" w-full="" rounded-box="" min-h-40vh="" border=""></div></div></div></div></div> <div><button btn="~ primary"><i></i> </button></div></form>'),ve=(h,d,l)=>v(d,p(l(t(d)).add(-1,"day").format("YYYY-MM-DD"))),le=(h,d,l)=>v(d,p(l(t(d)).add(1,"day").format("YYYY-MM-DD"))),ue=z('<div absolute="" top-0="" z-20="" w-full="" h-2="" bg-neutral="" animate-pulse="" animate-count-infinite=""></div>'),ce=z('<div card="" relative=""><div absolute="" top-0="" right-0=""><span badge=""> </span></div> <img alt="Album" rounded-xl="" min-h-48=""> <div important-px-2=""><a text-lg="" uppercase="" target="_blank"> </a> <div><span badge="" badge-primary=""> </span></div></div></div>'),pe=z('<div modal=""><div w-5xl="" max-w-full=""><button modal-close="">&times;</button> <!></div></div> <div><div sticky="" top-0="" z-10="" bg-base-a="" pt-10="" pb-3="" mx--5="" px-5=""><div flex="" gap-5=""><h1 text-xl="">Sites Monitoring</h1> <button btn="~ sm circle outline" aria-label="Refresh" p-.5=""><i i-bx-refresh="" animate-reverse=""></i></button></div> <div><div flex=""><a href="../" btn="~ xs"> </a></div></div> <div flex="" pt-5="" gap-5="" justify-between=""><div whitespace-nowrap=""><span btn="~ sm primary"> </span> <span btn="~ sm success"> </span> <span btn="~ sm error"> </span></div> <div group-x-rounded=""><input input="" type="date" w-48=""> <button btn=""><i i-bx-chevron-left=""></i></button> <button btn=""><i i-bx-chevron-right=""></i></button></div></div></div> <div bg-base-a="" min-h-70vh="" sticky="" top-20=""><!> <div relative="" z-20="" pt-5=""><div grid="" grid-cols-1="" md:grid-cols-3="" gap-5=""></div></div></div></div>',!0);function _e(h,d){Ha(d,!0);const l={};La(l);const w=()=>la(G,"$loading",l),J=()=>la(ie,"$t",l);function xa(r,s){return r.reduce((u,c,f,b,m=s(c))=>((u[m]||(u[m]=[])).push(c),u),{})}let S=E(void 0),j=E(p({error:0,success:0,total:0})),_=E(p($().format("YYYY-MM-DD"))),i=E(void 0);Na(()=>{K()});async function K(){k(G,!0),v(S,p(await D.collection("sitesAudit").getList(1,500,{filter:[`created>="${t(_)}"`,`created<"${$(t(_)).add(1,"day").format("YYYY-MM-DD")}"`].join("&&"),expand:"siteId,screenshot",sort:"@random"})));let r=xa(t(S)?.items||[],s=>s.status);v(j,p({success:r.success?.length||0,error:r.error?.length||0,total:t(S)?.items?.length||0})),setTimeout(()=>k(G,!1),500)}async function ga(){k(G,!0);try{const r={template:t(i).template,question:t(i).id,answer:t(i).answer,score:t(i).score,media:t(i).file?[...t(i).file]:void 0};console.log(r,t(i)),t(i).aid?await D.collection("auditsDetails").update(t(i).aid,r):await D.collection("auditsDetails").create(r),k(ma,[{action:J()("action.saved")}])}catch(r){console.log(r),k(ma,[{error:r?.data}])}v(i,!1),K()}var V=te(h,!0,pe),O=Za(V),ha=e(O),W=e(ha),wa=a(a(W)),ya=a(a(O)),X=e(ya),Z=e(X),Ya=e(Z),aa=a(a(Ya)),ka=e(aa),ea=a(a(Z)),Ma=e(ea),Da=e(Ma),$a=e(Da),za=a(a(ea)),ta=e(za),ia=e(ta),Sa=e(ia),ra=a(a(ia)),ja=e(ra),Oa=a(a(ra)),Aa=e(Oa),Ia=a(a(ta)),L=e(Ia);fa(L);var sa=a(a(L)),Pa=a(a(sa)),Ta=a(a(X)),oa=e(Ta),qa=a(a(oa)),Ba=e(qa);F($a,()=>J()("all.info")),H(()=>{M(ka,"animate-spin",w()),x(Sa,`Total : ${g(t(j).total)}`),x(ja,`Success : ${g(t(j).success)}`),x(Aa,`Error : ${g(t(j).error)}`)}),ca(O,(r,s)=>re(r,s),()=>t(i)),pa("close",O,()=>v(i,!1),!1),W.__click=[oe,i],_a(wa,()=>t(i),r=>{var s=C(r,!0,ne),u=e(s),c=e(u),f=a(a(u)),b=e(f),m=e(b),A=a(a(b)),I=e(A),y=e(I),P=a(a(y)),N=e(P),T=a(a(N));fa(T);var q=a(a(I)),Y=e(q),da=a(a(Y));Wa(da);var Ea=a(a(q)),na=e(Ea),Fa=a(a(na)),Ua=e(Fa),Ca=a(a(f)),Ga=e(Ca),B=e(Ga),Ja=a(B);F(Ja,()=>` ${g(J()("save.btn"))}`),H(()=>{x(c,`${g(t(i).question)} (${g(t(i).score)})`),x(m,t(i).hint),M(B,"i-bx-save",!w()),M(B,"i-bx-refresh",w()),M(B,"animate-spin",w())}),pa("submit",s,ae(ga),!1),ca(P,(o,R)=>se(o,R),()=>t(i).options),Q(T,()=>t(i).score,o=>t(i).score=o),Q(da,()=>t(i).answer,o=>t(i).answer=o),Xa("files","change","set",na,()=>t(i).file,o=>t(i).file=o),ua(Ua,()=>t(i).media,73,(o,R,fe)=>{var va=C(o,!0,de),Ka=e(va);ba(Ka,"src",()=>D.files.getUrl(t(i),n(R))),U(o,va)},null),U(r,s)},null),aa.__click=K,Q(L,()=>t(_),r=>v(_,p(r))),sa.__click=[ve,_,$],Pa.__click=[le,_,$],_a(oa,w,r=>{var s=C(r,!0,ue);U(r,s)},null),ua(Ba,()=>t(S)?.items,73,(r,s,u)=>{var c=C(r,!0,ce),f=e(c),b=e(f),m=e(b),A=a(a(f)),I=a(a(A)),y=e(I),P=e(y),N=a(a(y)),T=e(N),q=e(T);ba(A,"src",()=>D.getFileUrl(n(s)?.expand?.screenshot,n(s)?.expand?.screenshot?.media)),F(P,()=>n(s)?.expand?.siteId?.name?.replace(".mojokertokota.go.id","")),F(q,()=>$(n(s).created).format("YYYY-MM-DD hh:mm:ss"));var Y;H(()=>{M(b,"badge-success",n(s).status=="success"),x(m,n(s).status),Y!==(Y="http://"+n(s)?.expand?.siteId?.name)&&ee(y,"href",Y)}),U(r,c)},null),Qa(h,V),Ra()}Va(["click"]);const ke=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"}));export{_e as _,ke as a};
